{"version":3,"file":"RequestsListItem.js","sources":["../src/RequestsListItem.ts"],"sourcesContent":["/* eslint-disable lit-a11y/click-events-have-key-events */\n// import { ACTION } from '@blindnet/prci/src/models/priv-terms';\nimport { ACTION } from '@blindnet/prci/dist/models/priv-terms.js';\nimport { msg } from '@lit/localize';\nimport { css, html, LitElement, PropertyValueMap } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { choose } from 'lit/directives/choose.js';\nimport { when } from 'lit/directives/when.js';\nimport { PendingDemandResponse } from './models/pending-demand-response.js';\nimport { PendingRequestsResponse } from './models/pending-requests-response.js';\nimport { DCIStyles } from './styles.js';\nimport { approveDemand, getPendingDemand } from './utils/data-consumer-api.js';\n\nenum REQ_ITEM_UI_STATE {\n  PENDING_DECISION,\n  APPROVED,\n  DENIED,\n}\n\n/**\n * A single item in the pending requests list\n */\n@customElement('requests-list-item')\nexport class RequestsListItem extends LitElement {\n  static styles = [\n    DCIStyles,\n    css`\n      :host {\n        border: 2px solid #5b5b5b;\n        border-radius: 10px;\n        box-shadow: 0px 5px 10px 0px rgba(0, 0, 0, 0.5);\n      }\n\n      #summary-ctr {\n        display: grid;\n        grid-template-columns: repeat(3, 1fr);\n        padding: 20px 0px;\n      }\n\n      .dmd-info-element {\n        display: inline-flex;\n        justify-items: center;\n        text-align: center;\n        justify-self: center;\n        align-items: center;\n      }\n\n      #dmd-details-ctr {\n        display: flex;\n        justify-items: center;\n        justify-content: center;\n        padding: 20px;\n        column-gap: 40px;\n      }\n\n      #approve-btn {\n        border-color: #51d214;\n      }\n\n      #deny-btn {\n        border-color: #f90707;\n      }\n\n      .dmd-btn {\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,\n          Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\n        font-size: 18px;\n        padding: 20px;\n        border: 4px solid;\n        border-radius: 10px;\n        border-width: 4px;\n        background: none;\n        width: 200px;\n        text-align: center;\n      }\n\n      .decision-ctr {\n        padding: 20px;\n        font-size: 16px;\n      }\n\n      li {\n        text-align: left;\n      }\n    `,\n  ];\n\n  @property({ attribute: false }) demand: PendingRequestsResponse = {\n    id: '',\n    date: '',\n    action: ACTION.ACCESS,\n    data_subject: {\n      id: '',\n      schema: '',\n    },\n  };\n\n  @state() _open: boolean = false;\n\n  @state() _demandDetails: PendingDemandResponse | undefined;\n\n  @state() _uiState: REQ_ITEM_UI_STATE = REQ_ITEM_UI_STATE.PENDING_DECISION;\n\n  protected willUpdate(\n    _changedProperties: PropertyValueMap<any> | Map<PropertyKey, unknown>\n  ): void {\n    if (_changedProperties.has('demand')) {\n      getPendingDemand(this.demand.id).then(response => {\n        this._demandDetails = response;\n      });\n    }\n  }\n\n  approveDemand() {\n    approveDemand(this.demand.id, 'Approved').then(() => {\n      this._uiState = REQ_ITEM_UI_STATE.APPROVED;\n    });\n  }\n\n  denyDemand() {\n    this._uiState = REQ_ITEM_UI_STATE.DENIED;\n  }\n\n  render() {\n    return html`\n      ${choose(this._uiState, [\n        [\n          REQ_ITEM_UI_STATE.PENDING_DECISION,\n          () => html`\n            <div\n              id=\"summary-ctr\"\n              @click=${() => {\n                this._open = !this._open;\n              }}\n            >\n              <span class=\"dmd-info-element\"\n                >${new Date(this.demand.date).toLocaleDateString('en-gb')}</span\n              >\n              <span class=\"dmd-info-element\">John Smith</span>\n              <span class=\"dmd-info-element\">${this.demand.action}</span>\n            </div>\n            ${when(\n              this._open,\n              () => html`\n                <div id=\"dmd-details-ctr\">\n                  ${when(\n                    this._demandDetails,\n                    () => html`\n                      <button\n                        id=\"approve-btn\"\n                        class=\"dmd-btn animated-btn\"\n                        @click=${this.approveDemand}\n                      >\n                        Approve\n                      </button>\n                      <button\n                        id=\"deny-btn\"\n                        class=\"dmd-btn animated-btn\"\n                        @click=${this.denyDemand}\n                      >\n                        Deny\n                      </button>\n                    `,\n                    () => html` Getting demand details... `\n                  )}\n                </div>\n              `\n            )}\n          `,\n        ],\n        [\n          REQ_ITEM_UI_STATE.APPROVED,\n          () => html`\n            <div class=\"decision-ctr\">${msg('Demand Approved ✅')}</div>\n          `,\n        ],\n        [\n          REQ_ITEM_UI_STATE.DENIED,\n          () => html`\n            <div class=\"decision-ctr\">${msg('Demand Denied ❌')}</div>\n          `,\n        ],\n      ])}\n    `;\n  }\n}\n"],"names":[],"mappings":"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"}