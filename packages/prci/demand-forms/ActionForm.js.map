{"version":3,"file":"ActionForm.js","sources":["../../src/demand-forms/ActionForm.ts"],"sourcesContent":["import { msg } from '@lit/localize';\nimport {\n  css,\n  CSSResultGroup,\n  html,\n  LitElement,\n  PropertyValueMap,\n  TemplateResult,\n} from 'lit';\nimport { property } from 'lit/decorators.js';\nimport { choose } from 'lit/directives/choose.js';\nimport { Demand } from '../models/demand.js';\nimport { ACTION } from '../models/priv-terms.js';\nimport { buttonStyles } from '../styles.js';\nimport { ComponentState, DemandState } from '../utils/states.js';\n\nexport abstract class ActionForm extends LitElement {\n  @property({ type: Number, attribute: 'demand-state' })\n  demandState: DemandState = DemandState.EDIT_OPEN;\n\n  // eslint-disable-next-line no-restricted-globals\n  @property({ type: String }) demandGroupId = self.crypto.randomUUID();\n\n  @property({ attribute: false }) demands: Demand[] = [];\n\n  constructor() {\n    super();\n    this.demands = this.getDefaultDemands();\n  }\n\n  static styles = [\n    buttonStyles,\n    css`\n      :host {\n        margin: 0px 0px 0px 0px;\n      }\n\n      .btns-ctr {\n        display: grid;\n        grid-template-columns: repeat(2, 1fr);\n        padding: 0px 0px 0px 0px;\n        margin: 0px 0px 0px 0px;\n        transform: translateY(15px);\n      }\n\n      .back-btn {\n        grid-column: 1/2;\n      }\n\n      .add-btn {\n        grid-column: 2/3;\n      }\n    ` as CSSResultGroup,\n  ];\n\n  setDemand(demand: Demand) {\n    this.demands.push(demand);\n  }\n\n  deleteDemand(action: ACTION) {\n    this.demands.splice(\n      this.demands.findIndex(d => d.action === action),\n      1\n    );\n  }\n\n  addToPrivacyRequest(demandGroupId: string, demands: Demand[]) {\n    this.dispatchEvent(\n      new CustomEvent('demand-set-multiple', {\n        bubbles: true,\n        composed: true,\n        detail: {\n          demandGroupId,\n          demands,\n        },\n      })\n    );\n  }\n\n  /**\n   * Go back to the action menu\n   */\n  handleBackClick() {\n    this.dispatchEvent(\n      new CustomEvent('component-state-change', {\n        bubbles: true,\n        composed: true,\n        detail: {\n          newState: ComponentState.MENU,\n        },\n      })\n    );\n  }\n\n  /**\n   * On add click validate and add data then move to review\n   */\n  handleAddClick() {\n    if (this.validate()) {\n      this.addToPrivacyRequest(this.demandGroupId, this.demands);\n      this.dispatchEvent(\n        new CustomEvent('component-state-change', {\n          bubbles: true,\n          composed: true,\n          detail: {\n            newState: ComponentState.REVIEW,\n          },\n        })\n      );\n    }\n  }\n\n  /**\n   * Validate data entered before adding to Privacy Request\n   */\n  abstract validate(): boolean;\n\n  abstract getDefaultDemands(): Demand[];\n\n  /**\n   * Get the edit template for this action\n   * @param useDefault Indicates if form should be populated with default values or from input demands\n   * @returns HTML template\n   */\n  abstract getEditTemplate(demands: Demand[]): TemplateResult;\n\n  /**\n   * Ensure that we always use the default demands initially\n   * @param _changedProperties\n   */\n  protected willUpdate(\n    _changedProperties: PropertyValueMap<any> | Map<PropertyKey, unknown>\n  ): void {\n    if (\n      _changedProperties.has('demands') &&\n      (!this.demands || this.demands.length === 0)\n    ) {\n      this.demands = this.getDefaultDemands();\n    }\n  }\n\n  render(): TemplateResult<1 | 2> {\n    return html`\n      ${choose(this.demandState, [\n        [DemandState.EDIT_OPEN, () => this.getEditTemplate(this.demands)],\n      ])}\n      <!-- Buttons -->\n      <div class=\"btns-ctr\">\n        <button class=\"back-btn nav-btn ctr-btn\" @click=${this.handleBackClick}>\n          ${msg('Back')}\n        </button>\n        <button class=\"add-btn nav-btn ctr-btn\" @click=${this.handleAddClick}>\n          ${msg('Add demand to Privacy Request')}\n        </button>\n      </div>\n    `;\n  }\n}\n"],"names":[],"mappings":"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"}