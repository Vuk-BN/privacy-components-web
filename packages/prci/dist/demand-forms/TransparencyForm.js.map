{"version":3,"file":"TransparencyForm.js","sources":["../../src/demand-forms/TransparencyForm.ts"],"sourcesContent":["import { html, css, LitElement } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { choose } from 'lit/directives/choose.js';\nimport { msg } from '@lit/localize';\n\nimport '../DemandBuilderDropdownElement.js';\nimport '../DemandBuilderTextElement.js';\nimport { ACTION } from '../models/priv-terms.js';\nimport { Demand } from '../models/demand.js';\nimport { ACTION_DESCRIPTIONS } from '../utils/dictionary.js';\nimport { DemandState } from '../utils/states.js';\nimport { enabledActions } from '../utils/conf.js';\n\n/**\n * ActionForm for the Transparency PRIV action. Includes a dropdown and text element.\n *\n * The transparency form follows a different pattern than the other actions, as each\n * TRANSPARENCY.* actually represents a completely separate demand, but we display them\n * all in one DemandBuilder element.\n */\n@customElement('transparency-form')\nexport class TransparencyForm extends LitElement {\n  @property({ type: Number, attribute: 'demand-state' })\n  demandState: DemandState = DemandState.EDIT;\n\n  @property({ type: Array, attribute: false })\n  transparencyActions: ACTION[] = [];\n\n  @property({ attribute: false }) demands = new Map<string, Demand>();\n\n  @property({ attribute: false }) demandBuilderId: string = '';\n\n  private _extraMessage = undefined;\n\n  constructor() {\n    super();\n\n    this.addEventListener('dropdown-element-add', e => {\n      const details = (e as CustomEvent).detail;\n      const demandId = crypto.randomUUID();\n      const demand: Demand = {\n        action: details.id,\n        message: this._extraMessage,\n      };\n      this.demands.set(demandId, demand);\n\n      // Fire event to set a single demand\n      const setEvent = new CustomEvent('demand-set', {\n        bubbles: true,\n        composed: true,\n        detail: {\n          demandId,\n          demand,\n        },\n      });\n      this.dispatchEvent(setEvent);\n\n      // Fire event indicating the demand builder is in a valid state once one choice is selected\n      if (details['first-selection']) {\n        const dmdValidEvent = new CustomEvent('demand-validated', {\n          bubbles: true,\n          composed: true,\n          detail: {\n            demandBuilderId: this.demandBuilderId,\n          },\n        });\n        this.dispatchEvent(dmdValidEvent);\n      }\n    });\n\n    this.addEventListener('dropdown-element-delete', e => {\n      const details = (e as CustomEvent).detail;\n      // Delete demands for the unchecked action\n      Array.from(this.demands)\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        .filter(([_, d]) => d.action === details.id)\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        .forEach(([id, _]) => {\n          this.demands.delete(id);\n          // Fire event to delete a single demand\n          const event = new CustomEvent('demand-delete', {\n            bubbles: true,\n            composed: true,\n            detail: {\n              id,\n            },\n          });\n          this.dispatchEvent(event);\n        });\n\n      // Fire event indicating the demand builder for this form is in an invalid state\n      if (details['none-selected']) {\n        const event = new CustomEvent('demand-invalidated', {\n          bubbles: true,\n          composed: true,\n          detail: {\n            demandBuilderId: this.demandBuilderId,\n          },\n        });\n        this.dispatchEvent(event);\n      }\n    });\n\n    this.addEventListener('text-element-change', e => {\n      this._extraMessage = (e as CustomEvent).detail?.text;\n      // Update existing demands\n      this.demands.forEach(d => {\n        const demand = d;\n        demand.message = this._extraMessage;\n      });\n\n      // Fire event to set multiple demands\n      const event = new CustomEvent('demand-set-multiple', {\n        bubbles: true,\n        composed: true,\n        detail: {\n          demands: this.demands,\n        },\n      });\n      this.dispatchEvent(event);\n    });\n  }\n\n  static styles = css`\n    :host {\n      display: grid;\n      row-gap: 35px;\n      grid-column: 2/5;\n      align-content: flex-start;\n      border: 2px solid #000;\n      border-radius: 20px;\n      padding: 40px 60px 40px 60px;\n      margin: 0px;\n    }\n\n    :host([demand-state='2']) {\n      padding: 30px;\n      grid-column: 1/5;\n    }\n\n    #dmd-ctr {\n      display: grid;\n      row-gap: 20px;\n    }\n\n    #dmd-ctr ul {\n      margin: 0;\n    }\n\n    #dmd-ctr li:not(:last-child) {\n      margin-bottom: 15px;\n    }\n\n    #edit-heading-1 {\n      font-weight: bold;\n      grid-column: 1/2;\n      padding: 0px 0px 0px 10px;\n    }\n\n    #review-heading-1 {\n      font-weight: bold;\n      /* padding: 0px; */\n    }\n\n    #extra-msg-txt {\n      padding: 0px 0px 0px 20px;\n    }\n\n    p {\n      margin: 0px;\n    }\n  `;\n\n  /**\n   * Get the edit display for a transparency demand\n   * @returns HTML template for edit display\n   */\n  getEditTemplate() {\n    const selectedActions = Object.values(this.demands).map(d => d.action);\n    return html`\n      <p id=\"edit-heading-1\">\n        <b>${msg('Details of my TRANSPARENCY Demand')}</b>\n      </p>\n      <demand-builder-dropdown-element\n        .choices=${this.transparencyActions.map(a => ({\n          id: a,\n          description: ACTION_DESCRIPTIONS[a](),\n          checked: selectedActions.includes(a),\n          disabled: !enabledActions.get(a) ?? true,\n        }))}\n      ></demand-builder-dropdown-element>\n      <demand-builder-text-element></demand-builder-text-element>\n    `;\n  }\n\n  /**\n   * Get the review display for a transparency demand\n   * @returns HTML template for review display\n   */\n  getReviewTemplate() {\n    return html`\n      <div id=\"dmd-ctr\">\n        <p id=\"review-hd-1\"><b>${msg('TRANSPARENCY demand')}</b></p>\n        <p>${msg('I want to know:')}</p>\n        <ul id=\"transparency-demand-review-list\">\n          ${Array.from(this.demands.values()).map(\n            (a: Demand) =>\n              html` <li><b>${ACTION_DESCRIPTIONS[a.action]()}</b></li> `\n          )}\n        </ul>\n        ${this._extraMessage\n          ? html`\n              <p>${msg('Plus additional info:')}</p>\n              <p id=\"extra-msg-txt\"><i>${this._extraMessage}</i></p>\n            `\n          : null}\n      </div>\n    `;\n  }\n\n  render() {\n    return html`\n      ${choose(this.demandState, [\n        [DemandState.EDIT, () => this.getEditTemplate()],\n        [DemandState.REVIEW, () => this.getReviewTemplate()],\n      ])}\n    `;\n  }\n}\n"],"names":[],"mappings":"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"}